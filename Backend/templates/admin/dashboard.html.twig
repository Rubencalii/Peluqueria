{% extends 'admin/base.html.twig' %}

{% block admin_title %}Dashboard de Gestión{% endblock %}

{% block admin_content %}
<div class="max-w-[1400px] mx-auto space-y-8 animate-fade-in-up">
    <!-- KPI Summary Row -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- KPI 1 -->
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-1.5 h-full bg-primary"></div>
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-slate-500 mb-1">Citas para hoy</p>
                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ todayAppointmentsCount }}</h3>
                </div>
                <div class="p-3 bg-primary/10 rounded-xl text-primary group-hover:bg-primary group-hover:text-white transition-all duration-300">
                    <span class="material-icons-outlined">calendar_month</span>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-1.5 text-xs text-emerald-500 font-semibold bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded w-fit">
                <span class="material-icons-outlined text-[14px]">trending_up</span>
                <span>+12% vs ayer</span>
            </div>
        </div>

        <!-- KPI 2 -->
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-1.5 h-full bg-emerald-500"></div>
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-slate-500 mb-1">Ingresos Previstos</p>
                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ todayRevenue|number_format(2, ',', '.') }}€</h3>
                </div>
                <div class="p-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-xl text-emerald-600 dark:text-emerald-400 group-hover:bg-emerald-500 group-hover:text-white transition-all duration-300">
                    <span class="material-icons-outlined">payments</span>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-1.5 text-xs text-slate-400 font-medium">
                <span>Estimación basada en agenda</span>
            </div>
        </div>

        <!-- KPI 3 -->
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-1.5 h-full bg-amber-500"></div>
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-slate-500 mb-1">Clientes Nuevos</p>
                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ newCustomersCount }}</h3>
                </div>
                <div class="p-3 bg-amber-100 dark:bg-amber-900/30 rounded-xl text-amber-600 dark:text-amber-400 group-hover:bg-amber-500 group-hover:text-white transition-all duration-300">
                    <span class="material-icons-outlined">group_add</span>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-1.5 text-xs text-emerald-500 font-semibold bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded w-fit">
                <span>Buen ritmo</span>
            </div>
        </div>

        <!-- KPI 4 -->
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 relative overflow-hidden group">
            <div class="absolute top-0 left-0 w-1.5 h-full bg-purple-500"></div>
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-slate-500 mb-1">Servicios Activos</p>
                    <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ activeServicesCount }}</h3>
                </div>
                <div class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-xl text-purple-600 dark:text-purple-400 group-hover:bg-purple-500 group-hover:text-white transition-all duration-300">
                    <span class="material-icons-outlined">spa</span>
                </div>
            </div>
            <div class="mt-4 flex items-center gap-1.5 text-xs text-slate-400 font-medium">
                <span>Catálogo actualizado</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
        <!-- Daily Schedule (Maestro de Día) -->
        <div class="lg:col-span-8 bg-white dark:bg-slate-900 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800 p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Maestro de Día</h3>
                <div class="flex items-center gap-2">
                    <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-400 transition-colors">
                        <span class="material-icons-outlined">chevron_left</span>
                    </button>
                    <span class="text-sm font-semibold text-slate-700 dark:text-slate-300">{{ "now"|date("d M, Y") }}</span>
                    <button class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg text-slate-400 transition-colors">
                        <span class="material-icons-outlined">chevron_right</span>
                    </button>
                </div>
            </div>

            <!-- Schedule Grid -->
            <div class="overflow-x-auto custom-scrollbar">
                <div class="min-w-[600px] grid grid-cols-4 border border-slate-100 dark:border-slate-800 rounded-2xl overflow-hidden">
                    <!-- Column Header -->
                    <div class="p-4 bg-slate-50 dark:bg-slate-800/50 border-b border-r border-slate-100 dark:border-slate-800 text-center text-[10px] font-bold text-slate-400 uppercase tracking-widest">Hora</div>
                    {% for employee in employees %}
                        <div class="p-4 bg-slate-50 dark:bg-slate-800/50 border-b border-r border-slate-100 dark:border-slate-800 text-center">
                            <p class="text-sm font-bold text-slate-900 dark:text-white">{{ employee.name }}</p>
                            <p class="text-[10px] text-primary font-medium uppercase">{{ employee.specialty|default('Estilista') }}</p>
                        </div>
                    {% endfor %}

                    <!-- Rows -->
                    {% for hour in 9..20 %}
                        <div class="p-4 border-b border-r border-slate-100 dark:border-slate-800 text-center text-sm font-medium text-slate-400">{{ hour }}:00</div>
                        {% for employee in employees %}
                            <div class="p-2 border-b border-r border-slate-100 dark:border-slate-800 relative min-h-[80px] bg-slate-50/30 dark:bg-slate-800/10">
                                {% for appointment in appointments %}
                                    {% if appointment.employee.id == employee.id and appointment.startAt|date('H') == hour %}
                                        <div class="bg-primary/10 border-l-4 border-primary p-2 rounded-md shadow-sm">
                                            <p class="text-[10px] font-bold text-primary mb-0.5">{{ appointment.customer.name }}</p>
                                            <p class="text-[9px] text-slate-600 dark:text-slate-400 font-medium truncate">{{ appointment.service.name }}</p>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endfor %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Right Side Panel: Upcoming & Analytics -->
        <div class="lg:col-span-4 space-y-8">
            <!-- Weekly Performance Mini-Chart (Placeholder look) -->
            <div class="bg-white dark:bg-slate-900 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800 p-6">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4">Rendimiento Semanal</h3>
                <div class="flex items-end justify-between h-32 gap-3 mb-4">
                    {% for i in range(1, 7) %}
                        {% set h = random(30, 90) %}
                        <div class="flex-1 bg-primary/10 rounded-t-lg relative group transition-all duration-300 hover:bg-primary/30 cursor-pointer" style="height: {{ h }}%">
                            <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white text-[10px] px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                                {{ h * 10 }}€
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase px-1">
                    <span>Lun</span><span>Mar</span><span>Mie</span><span>Jue</span><span>Vie</span><span>Sab</span><span>Dom</span>
                </div>
            </div>

            <!-- Alerts / Notifications -->
            <div class="bg-white dark:bg-slate-900 rounded-3xl shadow-sm border border-slate-100 dark:border-slate-800 overflow-hidden">
                <div class="p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                    <h3 class="text-sm font-bold text-slate-900 dark:text-white uppercase tracking-widest">Alertas de Clientes</h3>
                    <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                </div>
                <div class="divide-y divide-slate-100 dark:divide-slate-800">
                    <div class="p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer group">
                        <div class="w-10 h-10 rounded-full bg-red-100 text-red-600 flex items-center justify-center shrink-0">
                            <span class="material-icons-outlined text-sm">warning</span>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-900 dark:text-white group-hover:text-primary transition-colors">María García</p>
                            <p class="text-[10px] text-slate-500">Alergia confirmada a tintes PPD.</p>
                        </div>
                    </div>
                    <div class="p-4 flex gap-3 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer group">
                        <div class="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0">
                            <span class="material-icons-outlined text-sm">celebration</span>
                        </div>
                        <div>
                            <p class="text-xs font-bold text-slate-900 dark:text-white group-hover:text-primary transition-colors">Carlos Ruiz</p>
                            <p class="text-[10px] text-slate-500">Cumpleaños hoy. Ofrecer 10% dto.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
